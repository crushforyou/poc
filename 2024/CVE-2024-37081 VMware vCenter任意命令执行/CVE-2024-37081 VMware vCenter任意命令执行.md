***描述***

此存储库包含 VMware vCenter 中 CVE-2024-37081 漏洞的概念验证 (PoC)。该漏洞是由于文件中的错误配置/etc/sudoers导致执行命令时允许保存危险的环境变量sudo。攻击者可以利用此漏洞以 root 权限执行任意命令。

***漏洞***

- **编号：**CVE-2024-37081
- **描述：**Defaults env_keep文件中的参数配置错误/etc/sudoers允许在命令执行期间传播危险的环境变量（PYTHONPATH、、、等）VMWARE_PYTHON_PATH，从而允许以 root 权限执行任意代码。VMWARE_PYTHON_BINsudo

- **受影响的用户/组：**

```
%operator (grupo)
%admin (grupo)
infraprofile (usuario)
vpxd (usuario)
sts (usuario)
pod (usuario)
```

***要求***

- Python 3.x
- Permisos de sudo

***指示***

***克隆此存储库：***

```
git clone https://github.com/Mr-r00t11/CVE-2024-37081.git
cd CVE-2024-37081
```

***存储库内容***

- poc.py：演示漏洞利用的 Python 脚本。
- README.md：这个文件。

***脚本详情***

该脚本poc.py执行以下步骤：

1. **create_malicious_code()/tmp/malicious/__init__.py** ：在执行命令的目录中创建恶意 Python 文件id并将输出保存到/tmp/pwned.
2. **execute_with_pythonpath()**：设置环境变量PYTHONPATH并/tmp/malicious运行 sudo 命令以用户身份导入 Python 模块operator。
3. **execute_with_vmware_python_path()**：与 类似execute_with_pythonpath()，但使用环境变量VMWARE_PYTHON_PATH并以用户身份执行命令pod。
4. **execute_with_vmware_python_bin()**：创建恶意 shell 脚本，将环境变量设置VMWARE_PYTHON_BIN为此脚本，并以用户身份执行 sudo 命令admin。
5. **execute_with_sendmail()**：以用户身份运行 sudo 命令以使用vpxd读取文件。/etc/shadowsendmail
6. **check_exploit_success()**：检查文件是否/tmp/pwned已创建，这表明恶意代码已成功执行。

***安全注意事项***

该脚本只能在受控环境中用于教育目的。未经授权利用系统漏洞是非法的，将受到法律制裁。确保您拥有适当的权限并完全理解运行此类代码的含义。